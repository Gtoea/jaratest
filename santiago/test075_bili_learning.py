'''
Show learning of bili mice across sessions.
'''

import sys
import numpy as np
import matplotlib.pyplot as plt
from jaratoolbox import behavioranalysis
from jaratoolbox import loadbehavior
from jaratoolbox import extraplots
from jaratoolbox import settings 

plt.clf()

cohort1 = range(0,9)   # bili016-024
cohort2 = range(10,19) # bili025-033

for inds,CASE in enumerate(cohort2):
    
    if CASE==0:
        subject = 'bili019'
        sessions = ['20190426a','20190427a','20190428a','20190429a','20190430a','20190501a','20190502a','20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==1:
        subject = 'bili016'
        sessions = ['20190427a','20190428a','20190429a','20190430a','20190501a','20190502a','20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==2:
        subject = 'bili017'
        sessions = ['20190428a','20190429a','20190430a','20190501a',   '20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==3:
        subject = 'bili023'
        sessions = ['20190430a','20190501a','20190502a','20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Corrupted: '20190529a'
    elif CASE==4:
        subject = 'bili022'
        sessions = ['20190501a','20190502a','20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==5:
        subject = 'bili018'
        sessions = ['20190503a','20190504a','20190505a','20190506a','20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==6:
        subject = 'bili021'
        sessions = ['20190507a','20190508a','20190509a','20190510a','20190511a','20190512a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==7:
        subject = 'bili024'
        sessions = ['20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
    elif CASE==8:
        subject = 'bili020'
        sessions = ['20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190601a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']

    elif CASE==10:
        subject = 'bili025'
        sessions = ['20190519a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190520a','20190601a'
    elif CASE==11:
        subject = 'bili026'
        sessions = ['20190517a','20190518a','20190519a','20190520a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Wrong session: '20190521a'   # Doesn't exist: '20190601a'
    elif CASE==12:
        subject = 'bili027'
        sessions = ['20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Wrong session: '20190521a'   # Doesn't exist: '20190601a'
    elif CASE==13:
        subject = 'bili028'
        sessions = ['20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190601a'
    elif CASE==14:
        subject = 'bili029'
        sessions = ['20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190601a'
    elif CASE==15:
        subject = 'bili030'
        sessions = ['20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Wrong session: '20190521a'   # Doesn't exist: '20190601a'
    elif CASE==16:
        subject = 'bili031'
        sessions = ['20190507a','20190508a','20190509a','20190510a','20190511a','20190513a','20190514a','20190515a','20190516a','20190517a','20190518a','20190519a','20190520a','20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190512a','20190601a'
    elif CASE==17:
        subject = 'bili032'
        sessions = ['20190521a','20190522a','20190523a','20190524a','20190525a','20190526a','20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190601a'
    elif CASE==18:
        subject = 'bili033'
        sessions = ['20190527a','20190528a','20190529a','20190530a','20190531a','20190602a','20190603a','20190604a','20190605a','20190606a','20190607a','20190608a','20190609a']
        # Doesn't exist: '20190601a'

    """        
    bili025 (F) Active-Active mouse (Began 2019-05-19)
    bili026 (F) Active-Active mouse (Began 2019-05-17)
        2019-05-21: bili026 trained and data saved as bili030.
    bili027 (F) Active-Passive mouse (Began 2019-05-15)
        2019-05-21: bili027 trained and data saved as bili031.
    bili028 (M) Active-Active mouse (Began on 2019-05-13)
    bili029 (M) Active-Passive mouse (Began on 2019-05-18)
    bili030 (M) Active-Passive mouse (Began on 2019-05-29) 
        2019-05-21: bili030 trained and data saved as bili026.
    bili031 (M) Active-Passive mouse (Began on 2019-05-07)
        2019-05-21: bili031 trained and data saved as bili027.
    bili032 (M) Active-Passive mouse (Began on 2019-05-21)
    bili033 (M) Active-Active mouse (Began 2019-05-27)
    """        

        
    """        
    bili019 (M) Active-Active mouse (Began on 2019-04-26)
    bili016 (M) Active-Passive mouse (Began on 2019-04-27)
    bili017 (M) Active-Active mouse (Began on 2019-04-28)
    bili023 (F) Active-Passive mouse (Began on 2019-04-30)
    bili022 (F) Active-Active mouse (Began on 2019-05-01)
    bili018 (M) Active-Passive mouse (Began on 2019-05-03)
    bili021 (F) Active-Active mouse (Began on 2019-05-07)
    bili024 (F) Active-Passive mouse (Began on 2019-05-13)
    bili020 (F) Active-Active mouse (Began on 2019-05-17)    
    """
    
   
    #datesRange = ['2019-04-26','2019-05-20']

    #bdata = behavioranalysis.load_many_sessions(subject,sessions=[],datesRange=datesRange)
    bdata = behavioranalysis.load_many_sessions(subject,sessions=sessions)

    nSessions = bdata['sessionID'][-1]
    correct = bdata['outcome']==bdata.labels['outcome']['correct']
    valid = bdata['valid'].astype(bool) & (bdata['choice']!=bdata.labels['choice']['none'])

    correctEachSession = np.empty(nSessions)
    validEachSession = np.empty(nSessions)
    for sessionID in range(nSessions):
        trialsThisSession = bdata['sessionID']==sessionID
        correctEachSession[sessionID] = np.sum(correct[trialsThisSession])
        validEachSession[sessionID] = np.sum(valid[trialsThisSession])

    fractionCorrect = correctEachSession/validEachSession

    plt.subplot(3,3,inds+1)
    plt.plot(fractionCorrect,'.-',lw=2,ms=16)
    plt.ylim([0.50,0.9])
    plt.xlim([0,50])
    plt.ylabel('Fraction correct')
    plt.xlabel('Session')
    plt.grid(True)
    plt.title(subject)
    plt.pause(0.01)
    plt.show()


    if 0:
        filename = 'bili016-bili024_20190426-20190609'
        filename = 'bili025-bili033_20190507-20190609'
        extraplots.save_figure(filename, 'pdf', [16,14], '/tmp/')
